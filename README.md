# Система управления автопарком

Веб-система для управления автопарком предприятия с прогнозированием технического обслуживания.

## Технологии

- **Backend**: Python 3.11+, Flask, SQLAlchemy
- **База данных**: PostgreSQL
- **Аутентификация**: JWT (Flask-JWT-Extended)
- **Экспорт**: PDF (ReportLab), Excel (openpyxl)
- **Email**: SMTP

## Установка

1. Установите зависимости:
```bash
pip install -r requirements.txt
```

2. Создайте файл `.env` на основе `.env.example`:
```bash
cp .env.example .env
```

3. Настройте переменные окружения в `.env`:
- `DATABASE_URL` - строка подключения к PostgreSQL
- `SECRET_KEY` - секретный ключ для Flask
- `JWT_SECRET_KEY` - секретный ключ для JWT
- `SMTP_*` - настройки SMTP для отправки email (опционально)

4. Создайте базу данных PostgreSQL:
```sql
CREATE DATABASE fleet_db;
```

5. Запустите миграции и заполните базу тестовыми данными:
```bash
python seed_data.py
```

6. Запустите приложение:
```bash
python run.py
```

Приложение будет доступно по адресу: http://localhost:5000

## Данные для входа

После выполнения `seed_data.py` доступны следующие пользователи:

- **Администратор**: `admin` / `password123`
- **Механик**: `mechanic1` / `password123`
- **Водитель**: `driver1` / `password123`

## Структура проекта

```
car/
├── app/
│   ├── __init__.py          # Инициализация Flask приложения
│   ├── models.py            # Модели данных (SQLAlchemy)
│   ├── routes.py             # Маршруты (API и веб)
│   ├── utils.py              # Утилиты (валидация VIN, прогнозы)
│   ├── export_utils.py       # Экспорт в PDF/Excel
│   ├── email_utils.py        # Отправка email уведомлений
│   └── templates/            # HTML шаблоны
│       ├── base.html
│       ├── login.html
│       ├── dashboard.html
│       ├── vehicles.html
│       ├── maintenance.html
│       ├── predictions.html
│       ├── notifications.html
│       ├── reports.html
│       └── vehicle_detail.html
├── config.py                 # Конфигурация приложения
├── seed_data.py              # Скрипт для заполнения БД
├── run.py                    # Точка входа приложения
├── requirements.txt          # Зависимости Python
└── README.md                 # Документация
```

## Основные функции

### 1. Учет техники
- CRUD операции для транспортных средств
- Валидация VIN-номеров
- Учет пробега и статуса ТС

### 2. График ТО
- История технического обслуживания
- Календарь предстоящих ТО
- Интеллектуальное планирование

### 3. Прогнозирование ТО
- Расчет на основе среднесуточного пробега
- Учет периодичности ТО (10000 км или 180 дней)
- Определение статуса (норма, скоро, срочно, просрочено)

### 4. Уведомления
- Email уведомления о предстоящих ТО
- Уведомления о ремонтах
- Системные уведомления

### 5. Ремонты
- Учет ремонтов
- Отслеживание статусов
- Расчет затрат

### 6. Отчеты
- Экспорт данных в PDF
- Экспорт данных в Excel
- Статистика по автопарку

## API Endpoints

### Аутентификация
- `POST /api/auth/login` - Вход в систему
- `POST /api/auth/register` - Регистрация (только для админов)

### Транспортные средства
- `GET /api/vehicles` - Список ТС
- `GET /api/vehicles/<id>` - Детали ТС
- `POST /api/vehicles` - Создание ТС
- `PUT /api/vehicles/<id>` - Обновление ТС
- `DELETE /api/vehicles/<id>` - Удаление ТС

### Техническое обслуживание
- `GET /api/vehicles/<id>/maintenance` - История ТО
- `POST /api/maintenance` - Создание записи ТО
- `GET /api/maintenance/upcoming` - Предстоящие ТО

### Ремонты
- `GET /api/vehicles/<id>/repairs` - История ремонтов
- `POST /api/repairs` - Создание записи о ремонте

### Пробег
- `GET /api/vehicles/<id>/mileage` - Журнал пробега
- `POST /api/vehicles/<id>/mileage` - Запись пробега

### Прогнозы
- `GET /api/vehicles/<id>/prediction` - Прогноз следующего ТО

### Дашборд
- `GET /api/dashboard/stats` - Статистика

### Экспорт
- `GET /api/export/vehicles/pdf` - Экспорт ТС в PDF
- `GET /api/export/vehicles/excel` - Экспорт ТС в Excel

## Роли пользователей

- **Администратор** - полный доступ ко всем функциям
- **Механик** - управление ТС, ТО, ремонтами
- **Водитель** - просмотр информации, запись пробега

## Цветовая схема

- Основной: `#2C3E50` (темный сине-серый)
- Акцентный: `#E74C3C` (красный для важных уведомлений)
- Вторичный: `#7F8C8D` (серый)
- Фон: `#ECF0F1` (светло-серый)
- Успех: `#27AE60` (зеленый)
- Предупреждение: `#F39C12` (оранжевый)
- Текст: `#2C3E50` (темный) и `#FFFFFF` (белый)

## Алгоритм прогнозирования ТО

Прогноз основан на:
1. Последнем ТО и указанном следующем пробеге
2. Текущем пробеге транспортного средства
3. Среднесуточном пробеге (рассчитывается из последних 30 записей)
4. Периодичности ТО: 10000 км или 180 дней (что наступит раньше)

Статусы:
- **Норма** - ТО более чем через 30 дней
- **Скоро** - ТО через 7-30 дней
- **Срочно** - ТО менее чем через 7 дней
- **Просрочено** - ТО должно было быть выполнено

## Лицензия

Проект создан для внутреннего использования.


